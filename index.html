<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Show do Milh√£o</title>
    <link rel="icon" type="image/png" href="favicon.png">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS Base (igual ao anterior) */
        body { 
            font-family: 'Oswald', sans-serif; 
            background: radial-gradient(ellipse at center, #1e3a8a 0%, #0c1a54 70%); 
            color: #ffffff; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            margin: 0; 
            text-align: center; 
            padding: 10px; 
        }
        
        #start-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #0c1a54; display: flex; justify-content: center; align-items: center; z-index: 100; cursor: pointer; transition: opacity 0.5s; }
        #start-overlay p { font-size: 2em; color: #facc15; animation: pulse 2s infinite; text-shadow: 0 0 10px #facc15; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #mute-music-btn { position: fixed; top: 15px; right: 15px; background-color: rgba(255, 255, 255, 0.2); color: white; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 1.5em; cursor: pointer; z-index: 50; transition: background-color 0.3s; }
        #mute-music-btn:hover { background-color: rgba(255, 255, 255, 0.4); }
        #game-container { background-color: #1e3a8a; border-radius: 20px; padding: 20px; width: 100%; max-width: 900px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); visibility: hidden; opacity: 0; transition: opacity 0.5s; border: 2px solid rgba(255, 255, 255, 0.1); }
        #start-screen { display: block; }
        #game-screen { display: none; }
        
        h1 { 
            font-size: 3em; 
            color: #facc15; 
            margin-bottom: 10px; 
            text-shadow: 0 0 8px #f59e0b, 0 0 15px #facc15; 
        }
        
        #start-screen p { font-size: 1.2em; margin-bottom: 30px; font-weight: 400; }
        #subject-selection-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-top: 20px; }
        
        .subject-btn { 
            background-color: #facc15; 
            color: #0c1a54; 
            font-size: 1.2em; 
            font-weight: 700; 
            padding: 20px 15px; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s, top 0.1s; 
            box-shadow: 0 5px #f59e0b; 
            position: relative;
            top: 0;
        }
        .subject-btn:hover { 
            transform: scale(1.05) translateY(-3px); 
            background-color: #f59e0b; 
            box-shadow: 0 7px #f59e0b;
        }
        .subject-btn:active {
            top: 3px; 
            box-shadow: 0 2px #f59e0b;
        }
        
        .subject-btn[data-subject="misto"] { background-color: #7c3aed; color: white; box-shadow: 0 5px #5b21b6; }
        .subject-btn[data-subject="misto"]:hover { background-color: #9d5dff; transform: scale(1.05) translateY(-3px); box-shadow: 0 7px #5b21b6; }
        .subject-btn[data-subject="misto"]:active { top: 3px; box-shadow: 0 2px #5b21b6; }

        #main-content-area { display: flex; gap: 20px; flex-wrap: wrap; }
        #game-panel { flex: 2; display: flex; flex-direction: column; min-width: 300px; }
        #prize-ladder-panel { flex: 1; background-color: rgba(0,0,0,0.2); border-radius: 10px; padding: 15px; min-width: 200px; }
        #prize-ladder-panel h2 { margin-top: 0; color: #facc15; font-size: 1.5em; text-shadow: 0 0 5px #f59e0b; }
        #prize-ladder { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column-reverse; }
        .prize-item { background-color: #1e40af; padding: 8px; margin-bottom: 5px; border-radius: 5px; text-align: center; font-weight: bold; font-size: 1.1em; transition: all 0.3s ease; }
        .prize-item.achieved-prize { background-color: #22c55e; color: #ffffff; }
        
        .prize-item.current-prize { 
            background-color: #f59e0b; 
            color: #0c1a54; 
            transform: scale(1.1); 
            box-shadow: 0 0 15px #f59e0b, 0 0 25px #facc15; 
        }
        
        #status-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background-color: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px; flex-wrap: wrap; gap: 10px; }
        #score, #question-counter { font-size: 1.1em; font-weight: bold; }
        #question-container { background-color: #2563eb; padding: 20px; border-radius: 10px; min-height: 100px; display: flex; justify-content: center; align-items: center; font-size: 1.6em; margin-bottom: 15px; font-weight: 400; line-height: 1.3; }
        #answers-container { display: grid; grid-template-columns: 1fr; gap: 10px; flex-grow: 1; }
        
        .answer-btn { 
            background-color: #1e40af; 
            color: white; 
            padding: 15px; 
            border-radius: 10px; 
            border: 2px solid #3b82f6; 
            font-size: 1.2em; 
            font-family: 'Oswald', sans-serif; 
            font-weight: 400;
            cursor: pointer; 
            transition: all 0.2s ease;
            text-align: left;
            box-shadow: 0 4px #1a327a; 
            position: relative; 
            top: 0;
        }
        .answer-btn:hover:not(:disabled) { 
            background-color: #3b82f6; 
            transform: scale(1.02) translateY(-2px); 
            box-shadow: 0 6px #1a327a;
        }
        
        .answer-btn:active:not(:disabled) {
            top: 2px; 
            box-shadow: 0 2px #1a327a; 
        }
        
        .answer-btn:disabled { 
            cursor: not-allowed; 
            opacity: 0.7; 
        } 
        
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); } 20%, 40%, 60%, 80% { transform: translateX(10px); } }
        @keyframes pulseCorrect { 0% { transform: scale(1); box-shadow: 0 0 5px #22c55e, 0 4px #1a327a; } 50% { transform: scale(1.05); box-shadow: 0 0 20px #22c55e, 0 4px #1a327a; } 100% { transform: scale(1); box-shadow: 0 0 5px #22c55e, 0 4px #1a327a; } }

        .answer-btn.correct { 
            background-color: #22c55e; 
            border-color: #16a34a; 
            animation: pulseCorrect 0.5s ease-out; 
            box-shadow: 0 4px #166534; 
        }
        .answer-btn.incorrect { 
            background-color: #ef4444; 
            border-color: #dc2626; 
            animation: shake 0.5s ease-in-out;
            box-shadow: 0 4px #b91c1c; 
        }
        
        #feedback-container { margin-top: 15px; font-size: 1.4em; font-weight: bold; min-height: 40px; }
        #next-button { background-color: #facc15; color: #0c1a54; font-size: 1.2em; padding: 10px 25px; border: none; border-radius: 10px; cursor: pointer; margin-top: 10px; display: none; font-family: 'Oswald', sans-serif; font-weight: 700; }
        #toggle-audio-button { background: none; border: none; font-size: 1.8em; cursor: pointer; color: white; }
        #help-buttons-container { display: flex; justify-content: center; gap: 15px; margin-top: 15px; }
        .help-btn { background-color: #7c3aed; color: white; border: none; padding: 10px 15px; font-size: 1em; font-weight: bold; border-radius: 8px; cursor: pointer; transition: background-color 0.2s; min-width: 120px; }
        .help-btn:hover:not(:disabled) { background-color: #9d5dff; }
        .help-btn:disabled { background-color: #585858; color: #ababab; cursor: not-allowed; }
        #shop-btn, #ranking-btn { background-color: #22c55e; color: white; font-size: 1.2em; font-weight: bold; padding: 15px; border: none; border-radius: 10px; cursor: pointer; transition: background-color 0.2s; margin-top: 20px; }
        #ranking-btn { background-color: #7c3aed; margin-top: 10px; }
        #shop-btn:hover { background-color: #16a34a; }
        #ranking-btn:hover { background-color: #9d5dff; }
        #coin-balance { font-size: 1.2em; font-weight: bold; color: #facc15; display: flex; align-items: center; gap: 5px; }
        #shop-modal, #ranking-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 110; }
        #shop-container, #ranking-container { background-color: #1e3a8a; padding: 30px; border-radius: 15px; box-shadow: 0 0 25px rgba(250, 204, 21, 0.5); width: 90%; max-width: 500px; text-align: center; border: 2px solid #facc15; }
        #shop-container h2, #ranking-container h2 { color: #facc15; margin-top: 0; }
        .shop-item { display: flex; justify-content: space-between; align-items: center; background-color: #0c1a54; padding: 15px; border-radius: 8px; margin-bottom: 10px; }
        .shop-item-name { font-size: 1.2em; }
        .buy-btn { background-color: #facc15; color: #0c1a54; font-weight: bold; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; transition: background-color 0.2s; }
        .buy-btn:hover { background-color: #f59e0b; }
        #close-shop-btn, #close-ranking-btn { background-color: #ef4444; color: white; margin-top: 20px; }
        #shop-coin-balance { margin-bottom: 20px; font-size: 1.2em; }
        #player-name-container { margin: 20px 0; }
        #player-name-input { padding: 12px; font-size: 1.1em; border-radius: 8px; border: 2px solid #3b82f6; background-color: #0c1a54; color: white; width: 80%; max-width: 400px; text-align: center; }
        #player-name-input::placeholder { color: #ccc; }
        #ranking-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; text-align: left; }
        .ranking-item { display: flex; justify-content: space-between; padding: 10px; background-color: #0c1a54; border-radius: 5px; margin-bottom: 8px; font-size: 1.1em; }
        .ranking-item span:first-child { font-weight: bold; }
        .ranking-item span:last-child { color: #facc15; }
        #timer-container { position: relative; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        #timer-visual { position: absolute; width: 100%; height: 100%; border-radius: 50%; background: conic-gradient(#facc15 calc(var(--progress, 100) * 1%), #3b82f6 0); transition: background 0.3s ease-out; }
        #timer-container.danger #timer-visual { background: conic-gradient(#ef4444 calc(var(--progress, 100) * 1%), #3b82f6 0); }
        #timer-text { font-size: 1.2em; font-weight: bold; color: #ffffff; z-index: 1; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUpFadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .slide-up-fade-in { animation: slideUpFadeIn 0.5s ease-out forwards; opacity: 0; }
        #decision-buttons-container { display: flex; justify-content: center; gap: 20px; margin-top: 10px; }
        #stop-btn, #continue-btn { font-size: 1.2em; font-weight: bold; padding: 10px 25px; border: none; border-radius: 10px; cursor: pointer; color: white; transition: background-color 0.2s; }
        #stop-btn { background-color: #ef4444; }
        #stop-btn:hover { background-color: #dc2626; }
        #continue-btn { background-color: #22c55e; }
        #continue-btn:hover { background-color: #16a34a; }
        @media (max-width: 768px) { #main-content-area { flex-direction: column-reverse; } #question-container { font-size: 1.2em; min-height: 80px; } .answer-btn { font-size: 1em; padding: 12px; } }
    </style>
</head>
<body>

    <div id="start-overlay"><p>Clique em qualquer lugar para come√ßar</p></div>
    <button id="mute-music-btn">üéµ</button>

    <div id="game-container">
        <div id="start-screen">
            <h1>Show do Milh√£o</h1>
            <p>Escolha uma mat√©ria para come√ßar!</p>
            <div id="player-name-container"><input type="text" id="player-name-input" placeholder="Digite seu nome para jogar"></div>
            <div id="subject-selection-container">
                <button class="subject-btn" data-subject="matematica">Matem√°tica</button>
                <button class="subject-btn" data-subject="historia">Hist√≥ria</button>
                <button class="subject-btn" data-subject="geografia">Geografia</button>
                <button class="subject-btn" data-subject="portugues">Portugu√™s</button>
                <button class="subject-btn" data-subject="artes">Artes</button>
                <button class="subject-btn" data-subject="misto">üé≤ Desafio Misto</button>
            </div>
            <button id="shop-btn">üè™ Loja</button>
            <button id="ranking-btn">üèÜ Ranking</button>
        </div>
        <div id="game-screen" style="display: none;">
            <div id="main-content-area">
                <div id="game-panel">
                    <div id="status-bar">
                        <div id="coin-balance">ü™ô 0</div>
                        <div id="score">Pr√™mio: R$ 0</div>
                        <div id="timer-container"><div id="timer-visual"></div><span id="timer-text">15</span></div>
                        <button id="toggle-audio-button">üîä</button>
                        <div id="question-counter">Pergunta 1 / 15</div>
                    </div>
                    <div id="question-container"></div>
                    <div id="answers-container"></div>
                    <div id="help-buttons-container">
                        <button class="help-btn" id="fifty-fifty-btn">üéì 50:50 (x0)</button>
                        <button class="help-btn" id="skip-btn">‚è© Pular (x0)</button>
                        <button class="help-btn" id="cards-btn">üÉè Cartas (x0)</button>
                    </div>
                    <div id="feedback-container"></div>
                    <button id="next-button">Pr√≥xima Pergunta</button>
                    <div id="decision-buttons-container" style="display: none;">
                        <button id="stop-btn">Parar</button>
                        <button id="continue-btn">Continuar</button>
                    </div>
                </div>
                <div id="prize-ladder-panel">
                    <h2>Pr√™mios</h2>
                    <ol id="prize-ladder"></ol>
                </div>
            </div>
        </div>
    </div>
    
    <div id="shop-modal" style="display: none;">
        <div id="shop-container">
            <h2>Loja de Ajudas</h2>
            <p id="shop-coin-balance">Seu saldo: ü™ô 0</p>
            <div id="shop-items-container">
                <div class="shop-item"><span class="shop-item-name">üéì Ajuda 50:50</span><button class="buy-btn" data-help="fiftyFifty">Comprar (50 ü™ô)</button></div>
                <div class="shop-item"><span class="shop-item-name">‚è© Pular Pergunta</span><button class="buy-btn" data-help="skip">Comprar (75 ü™ô)</button></div>
                <div class="shop-item"><span class="shop-item-name">üÉè Cartas</span><button class="buy-btn" data-help="cards">Comprar (40 ü™ô)</button></div>
            </div>
            <button id="close-shop-btn" class="buy-btn">Fechar</button>
        </div>
    </div>
    <div id="ranking-modal" style="display: none;">
        <div id="ranking-container">
            <h2>üèÜ Ranking dos Melhores</h2>
            <ol id="ranking-list"></ol>
            <button id="close-ranking-btn" class="buy-btn">Fechar</button>
        </div>
    </div>
    
    <audio id="musica-fundo" src="musica-fundo.mp3" loop></audio>
    <audio id="correct-sound" src="correct.mp3" preload="auto"></audio>
    <audio id="wrong-sound" src="wrong.mp3" preload="auto"></audio>
    <audio id="click-sound" src="click.mp3" preload="auto"></audio>
    <audio id="tick-sound" src="tick.mp3" loop preload="auto"></audio>

<script>
document.addEventListener('DOMContentLoaded', function() {

    const elements = {
        startOverlay: document.getElementById('start-overlay'),
        gameContainer: document.getElementById('game-container'),
        startScreen: document.getElementById('start-screen'),
        gameScreen: document.getElementById('game-screen'),
        subjectSelectionContainer: document.getElementById('subject-selection-container'),
        score: document.getElementById('score'),
        questionCounter: document.getElementById('question-counter'),
        questionContainer: document.getElementById('question-container'),
        answersContainer: document.getElementById('answers-container'),
        feedbackContainer: document.getElementById('feedback-container'),
        nextButton: document.getElementById('next-button'),
        toggleAudioButton: document.getElementById('toggle-audio-button'),
        prizeLadder: document.getElementById('prize-ladder'),
        muteMusicBtn: document.getElementById('mute-music-btn'),
        musicaFundo: document.getElementById('musica-fundo'),
        fiftyFiftyBtn: document.getElementById('fifty-fifty-btn'),
        skipBtn: document.getElementById('skip-btn'),
        cardsBtn: document.getElementById('cards-btn'),
        coinBalance: document.getElementById('coin-balance'),
        shopBtn: document.getElementById('shop-btn'),
        shopModal: document.getElementById('shop-modal'),
        closeShopBtn: document.getElementById('close-shop-btn'),
        shopItemsContainer: document.getElementById('shop-items-container'),
        shopCoinBalance: document.getElementById('shop-coin-balance'),
        playerNameInput: document.getElementById('player-name-input'),
        rankingBtn: document.getElementById('ranking-btn'),
        rankingModal: document.getElementById('ranking-modal'),
        rankingList: document.getElementById('ranking-list'),
        closeRankingBtn: document.getElementById('close-ranking-btn'),
        timerContainer: document.getElementById('timer-container'),
        timerVisual: document.getElementById('timer-visual'),
        timerText: document.getElementById('timer-text'),
        correctSound: document.getElementById('correct-sound'),
        wrongSound: document.getElementById('wrong-sound'),
        clickSound: document.getElementById('click-sound'),
        tickSound: document.getElementById('tick-sound'),
        decisionButtonsContainer: document.getElementById('decision-buttons-container'),
        stopBtn: document.getElementById('stop-btn'),
        continueBtn: document.getElementById('continue-btn')
    };

    const allQuestions = {
      "matematica": [
        {"question": "Qual o resultado de 8 + 9?", "answers": ["15", "16", "17", "18"], "correctAnswer": "17"},
        {"question": "Quanto √© 6 multiplicado por 8?", "answers": ["42", "48", "54", "56"], "correctAnswer": "48"},
        {"question": "Qual n√∫mero vem antes de 1.000?", "answers": ["999", "1.001", "990", "909"], "correctAnswer": "999"},
        {"question": "Um dia tem quantas horas?", "answers": ["12", "24", "36", "48"], "correctAnswer": "24"},
        {"question": "Qual √© a metade de 100?", "answers": ["25", "50", "75", "10"], "correctAnswer": "50"},
        {"question": "Se um produto custa R$ 80 e tem 10% de desconto, qual o valor do desconto?", "answers": ["R$ 10", "R$ 8", "R$ 5", "R$ 1"], "correctAnswer": "R$ 8"},
        {"question": "Quantos lados tem um hex√°gono?", "answers": ["5", "6", "7", "8"], "correctAnswer": "6"},
        {"question": "Qual √© a raiz quadrada de 144?", "answers": ["10", "11", "12", "13"], "correctAnswer": "12"},
        {"question": "Qual o resultado da express√£o (5 + 3) * 2?", "answers": ["11", "13", "16", "10"], "correctAnswer": "16"},
        {"question": "Um √¢ngulo de 90 graus √© chamado de:", "answers": ["Agudo", "Obtuso", "Reto", "Raso"], "correctAnswer": "Reto"},
        {"question": "Se uma viagem de 300 km √© feita em 3 horas, qual a velocidade m√©dia?", "answers": ["80 km/h", "90 km/h", "100 km/h", "120 km/h"], "correctAnswer": "100 km/h"},
        {"question": "O n√∫mero romano 'L' representa qual n√∫mero ar√°bico?", "answers": ["10", "50", "100", "500"], "correctAnswer": "50"},
        {"question": "Quanto √© 2 elevado √† quinta pot√™ncia (2‚Åµ)?", "answers": ["10", "16", "25", "32"], "correctAnswer": "32"},
        {"question": "Um c√≠rculo tem quantos graus?", "answers": ["90¬∞", "180¬∞", "270¬∞", "360¬∞"], "correctAnswer": "360¬∞"},
        {"question": "Qual √© 20% de 500?", "answers": ["50", "100", "20", "250"], "correctAnswer": "100"}
      ],
      "historia": [
        {"question": "Quem √© considerado o 'Pai da Avia√ß√£o'?", "answers": ["Santos Dumont", "Irm√£os Wright", "Leonardo da Vinci", "Graham Bell"], "correctAnswer": "Santos Dumont"},
        {"question": "Em que ano o homem pisou na Lua pela primeira vez?", "answers": ["1959", "1969", "1979", "1989"], "correctAnswer": "1969"},
        {"question": "Qual era o principal deus da mitologia grega?", "answers": ["Apolo", "Poseidon", "Hades", "Zeus"], "correctAnswer": "Zeus"},
        {"question": "A Segunda Guerra Mundial terminou em que ano?", "answers": ["1942", "1945", "1950", "1939"], "correctAnswer": "1945"},
        {"question": "Quem foi o primeiro presidente do Brasil?", "answers": ["Dom Pedro I", "Get√∫lio Vargas", "Marechal Deodoro", "Juscelino Kubitschek"], "correctAnswer": "Marechal Deodoro"},
        {"question": "Qual civiliza√ß√£o construiu a cidade de Machu Picchu?", "answers": ["Maias", "Astecas", "Incas", "Eg√≠pcios"], "correctAnswer": "Incas"},
        {"question": "A 'Guerra Fria' foi uma disputa ideol√≥gica entre quais duas superpot√™ncias?", "answers": ["EUA e China", "Reino Unido e Alemanha", "EUA e Uni√£o Sovi√©tica", "Jap√£o e China"], "correctAnswer": "EUA e Uni√£o Sovi√©tica"},
        {"question": "Qual presidente brasileiro ficou conhecido por construir Bras√≠lia?", "answers": ["J√¢nio Quadros", "Jo√£o Goulart", "Juscelino Kubitschek", "Get√∫lio Vargas"], "correctAnswer": "Juscelino Kubitschek"},
        {"question": "Qual destes eventos marcou o in√≠cio da Idade M√©dia?", "answers": ["Queda do Imp√©rio Romano", "Revolu√ß√£o Francesa", "Descobrimento da Am√©rica", "Guerra dos Cem Anos"], "correctAnswer": "Queda do Imp√©rio Romano"},
        {"question": "Quem foi o l√≠der da Revolta da Vacina no Rio de Janeiro?", "answers": ["Tiradentes", "Zumbi dos Palmares", "Ant√¥nio Conselheiro", "Oswaldo Cruz"], "correctAnswer": "Oswaldo Cruz"},
        {"question": "O Muro de Berlim dividia qual cidade?", "answers": ["Moscou", "Vars√≥via", "Berlim", "Viena"], "correctAnswer": "Berlim"},
        {"question": "Qual o nome do movimento que lutava pelo fim da ditadura militar no Brasil pedindo elei√ß√µes diretas?", "answers": ["Tropicalismo", "Diretas J√°", "Caras-Pintadas", "Canudos"], "correctAnswer": "Diretas J√°"},
        {"question": "Cle√≥patra foi a √∫ltima rainha de qual civiliza√ß√£o antiga?", "answers": ["Gr√©cia", "Roma", "P√©rsia", "Egito"], "correctAnswer": "Egito"},
        {"question": "Qual foi a primeira constitui√ß√£o do Brasil?", "answers": ["1824", "1891", "1934", "1988"], "correctAnswer": "1824"},
        {"question": "O per√≠odo conhecido como 'Renascimento' floresceu em qual continente?", "answers": ["√Åsia", "√Åfrica", "Am√©rica", "Europa"], "correctAnswer": "Europa"}
      ],
      "geografia": [
        {"question": "Qual √© a capital da Bahia?", "answers": ["Recife", "Fortaleza", "Salvador", "Macei√≥"], "correctAnswer": "Salvador"},
        {"question": "O Cristo Redentor est√° localizado em qual cidade?", "answers": ["S√£o Paulo", "Belo Horizonte", "Rio de Janeiro", "Bras√≠lia"], "correctAnswer": "Rio de Janeiro"},
        {"question": "Qual destes pa√≠ses N√ÉO faz fronteira com o Brasil?", "answers": ["Argentina", "Col√¥mbia", "Uruguai", "Chile"], "correctAnswer": "Chile"},
        {"question": "Qual √© o maior estado do Brasil em √°rea territorial?", "answers": ["Minas Gerais", "Bahia", "Amazonas", "Mato Grosso"], "correctAnswer": "Amazonas"},
        {"question": "Em qual regi√£o do Brasil se localiza o Pantanal?", "answers": ["Norte", "Nordeste", "Sul", "Centro-Oeste"], "correctAnswer": "Centro-Oeste"},
        {"question": "A Torre Eiffel √© um famoso ponto tur√≠stico de qual cidade?", "answers": ["Londres", "Roma", "Paris", "Berlim"], "correctAnswer": "Paris"},
        {"question": "Qual o nome do fen√¥meno que causa o aquecimento das √°guas do Oceano Pac√≠fico?", "answers": ["La Ni√±a", "El Ni√±o", "Tsunami", "Furac√£o"], "correctAnswer": "El Ni√±o"},
        {"question": "Qual o continente mais populoso do mundo?", "answers": ["√Åfrica", "Europa", "Am√©rica", "√Åsia"], "correctAnswer": "√Åsia"},
        {"question": "As Cataratas do Igua√ßu est√£o localizadas na fronteira do Brasil com qual pa√≠s?", "answers": ["Paraguai", "Uruguai", "Argentina", "Bol√≠via"], "correctAnswer": "Argentina"},
        {"question": "Qual √© o maior deserto quente do mundo?", "answers": ["Atacama", "Gobi", "Saara", "Kalahari"], "correctAnswer": "Saara"},
        {"question": "Qual pa√≠s √© conhecido como 'Terra do Sol Nascente'?", "answers": ["China", "Jap√£o", "√çndia", "Coreia do Sul"], "correctAnswer": "Jap√£o"},
        {"question": "O Rio S√£o Francisco, no Brasil, √© conhecido como o rio da:", "answers": ["Unidade Nacional", "Disc√≥rdia", "Felicidade", "Tristeza"], "correctAnswer": "Unidade Nacional"},
        {"question": "Qual o nome da camada de gases que envolve a Terra?", "answers": ["Litosfera", "Hidrosfera", "Atmosfera", "Biosfera"], "correctAnswer": "Atmosfera"},
        {"question": "Qual a montanha mais alta do mundo?", "answers": ["K2", "Monte Everest", "Aconc√°gua", "Mont Blanc"], "correctAnswer": "Monte Everest"},
        {"question": "Qual o oceano que banha a costa leste do Brasil?", "answers": ["Pac√≠fico", "√çndico", "√Årtico", "Atl√¢ntico"], "correctAnswer": "Atl√¢ntico"}
      ],
      "portugues": [
        {"question": "Qual o coletivo de 'peixes'?", "answers": ["Manada", "Cardume", "Alcateia", "Enxame"], "correctAnswer": "Cardume"},
        {"question": "Qual palavra N√ÉO √© um sin√¥nimo de 'casa'?", "answers": ["Lar", "Moradia", "Resid√™ncia", "Pr√©dio"], "correctAnswer": "Pr√©dio"},
        {"question": "Na frase 'O gato dorme', qual √© o verbo?", "answers": ["O", "gato", "dorme", "nenhum"], "correctAnswer": "dorme"},
        {"question": "Qual o ant√¥nimo de 'feliz'?", "answers": ["Alegre", "Contente", "Triste", "Sorridente"], "correctAnswer": "Triste"},
        {"question": "Qual dessas palavras est√° escrita corretamente?", "answers": ["Geito", "Jeito", "Jeitto", "Geitto"], "correctAnswer": "Jeito"},
        {"question": "A palavra 'menas' existe na l√≠ngua portuguesa?", "answers": ["Sim", "N√£o", "Apenas no plural", "Apenas em poesias"], "correctAnswer": "N√£o"},
        {"question": "Quem escreveu 'Dom Casmurro'?", "answers": ["Jos√© de Alencar", "Machado de Assis", "Carlos Drummond de Andrade", "Monteiro Lobato"], "correctAnswer": "Machado de Assis"},
        {"question": "'Bela' √© um exemplo de qual classe de palavra?", "answers": ["Substantivo", "Verbo", "Adjetivo", "Adv√©rbio"], "correctAnswer": "Adjetivo"},
        {"question": "Qual a grafia correta para o som de 'ss' em 'pa√ßoca'?", "answers": ["S", "SS", "√á", "C"], "correctAnswer": "√á"},
        {"question": "Quantas letras tem o alfabeto oficial da l√≠ngua portuguesa?", "answers": ["23", "24", "25", "26"], "correctAnswer": "26"},
        {"question": "A frase 'Choveu muito ontem' tem qual tipo de sujeito?", "answers": ["Simples", "Composto", "Oculto", "Inexistente"], "correctAnswer": "Inexistente"},
        {"question": "O que significa a sigla 'CEP'?", "answers": ["C√≥digo de Endere√ßamento Postal", "Cadastro de Entidade P√∫blica", "Central de Encomendas Pessoais", "Controle de Entrega Padr√£o"], "correctAnswer": "C√≥digo de Endere√ßamento Postal"},
        {"question": "Qual figura de linguagem est√° presente em 'O Sol sorria para mim'?", "answers": ["Met√°fora", "Hip√©rbole", "Personifica√ß√£o", "Ironia"], "correctAnswer": "Personifica√ß√£o"},
        {"question": "Qual o plural de 'cidad√£o'?", "answers": ["Cidad√£os", "Cidad√µes", "Cidad√£es", "Cidad√£s"], "correctAnswer": "Cidad√£os"},
        {"question": "A palavra 'atrav√©s' deve ser usada para indicar:", "answers": ["Posse", "Movimento por dentro de algo", "Oposi√ß√£o", "Tempo"], "correctAnswer": "Movimento por dentro de algo"}
      ],
      "artes": [
        {"question": "Quem √© o pintor da obra 'Abaporu'?", "answers": ["Candido Portinari", "Tarsila do Amaral", "Di Cavalcanti", "Anita Malfatti"], "correctAnswer": "Tarsila do Amaral"},
        {"question": "Misturando as cores azul e amarelo, obtemos qual cor?", "answers": ["Roxo", "Laranja", "Verde", "Marrom"], "correctAnswer": "Verde"},
        {"question": "Qual destes instrumentos √© de sopro?", "answers": ["Violino", "Piano", "Flauta", "Bateria"], "correctAnswer": "Flauta"},
        {"question": "O samba √© um g√™nero musical origin√°rio de qual pa√≠s?", "answers": ["Portugal", "Angola", "Espanha", "Brasil"], "correctAnswer": "Brasil"},
        {"question": "Quem esculpiu a famosa est√°tua de 'Davi'?", "answers": ["Leonardo da Vinci", "Donatello", "Rafael Sanzio", "Michelangelo"], "correctAnswer": "Michelangelo"},
        {"question": "Qual arte marcial brasileira combina dan√ßa e luta?", "answers": ["Jiu-Jitsu", "Jud√¥", "Capoeira", "Karat√™"], "correctAnswer": "Capoeira"},
        {"question": "Em qual cidade fica o famoso museu do Louvre?", "answers": ["Roma", "Londres", "Paris", "Madri"], "correctAnswer": "Paris"},
        {"question": "Qual artista ficou famoso por suas pinturas de latas de sopa Campbell?", "answers": ["Pablo Picasso", "Andy Warhol", "Salvador Dal√≠", "Vincent van Gogh"], "correctAnswer": "Andy Warhol"},
        {"question": "O 'frevo' √© uma dan√ßa t√≠pica de qual estado brasileiro?", "answers": ["Bahia", "Rio de Janeiro", "Pernambuco", "Cear√°"], "correctAnswer": "Pernambuco"},
        {"question": "Qual √© o nome da arte japonesa de dobrar pap√©is?", "answers": ["Kirigami", "Origami", "Ikebana", "Sum√¥"], "correctAnswer": "Origami"},
        {"question": "Quem foi o arquiteto respons√°vel por grande parte dos projetos de Bras√≠lia?", "answers": ["Aleijadinho", "Oscar Niemeyer", "Ruy Ohtake", "Lina Bo Bardi"], "correctAnswer": "Oscar Niemeyer"},
        {"question": "A 'Turma da M√¥nica' foi criada por qual cartunista brasileiro?", "answers": ["Ziraldo", "Laerte", "Angeli", "Mauricio de Sousa"], "correctAnswer": "Mauricio de Sousa"},
        {"question": "Qual movimento art√≠stico √© conhecido por suas representa√ß√µes de sonhos e do inconsciente?", "answers": ["Cubismo", "Impressionismo", "Surrealismo", "Realismo"], "correctAnswer": "Surrealismo"},
        {"question": "Qual compositor √© conhecido como o 'Rei do Bai√£o'?", "answers": ["Tom Jobim", "Vinicius de Moraes", "Luiz Gonzaga", "Cartola"], "correctAnswer": "Luiz Gonzaga"},
        {"question": "O Oscar √© o pr√™mio mais famoso de qual forma de arte?", "answers": ["M√∫sica", "Teatro", "Pintura", "Cinema"], "correctAnswer": "Cinema"}
      ]
    };
    
    const defaultGameState = { playerCoins: 100, helpInventory: { fiftyFifty: 1, skip: 1, cards: 1 } };
    const gameState = {
        shuffledQuestions: [], currentQuestionIndex: 0, score: 0, isGameOver: false, isMusicMuted: false, isAudioEnabled: true,
        ptBrVoice: null, playerCoins: defaultGameState.playerCoins, helpInventory: {...defaultGameState.helpInventory}, 
        playerName: '', timerInterval: null, timeLeft: 15
    };

    const prizeLevels = [0, 500, 1000, 2000, 3000, 5000, 10000, 20000, 30000, 50000, 75000, 100000, 200000, 500000, 1000000];
    const helpPrices = { fiftyFifty: 50, skip: 75, cards: 40 };
    const COINS_PER_CORRECT_ANSWER = 15;
    const TIMER_DURATION = 15;
    const safeHavens = [10000, 100000];

    // REMOVIDO: saveProgress e loadProgress
    
    // CORRIGIDO: initialSetup agora √© s√≠ncrono
    function initialSetup() {
        // As perguntas j√° est√£o carregadas em 'allQuestions'
        enableGame(); 
    }

    function enableGame() {
        // Usa defaults, sem loadProgress
        updateCoinDisplay();
        updateHelpButtonsUI();
        setupEventListeners(); 
        speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();
    }

    function setupEventListeners() {
        elements.startOverlay.addEventListener('click', () => {
            elements.musicaFundo.play().catch(console.error);
            if (speechSynthesis.speaking) speechSynthesis.cancel();
            speechSynthesis.speak(new SpeechSynthesisUtterance('')); 
            elements.startOverlay.style.opacity = '0';
            setTimeout(() => { elements.startOverlay.style.display = 'none'; }, 500);
            elements.gameContainer.style.visibility = 'visible'; 
            elements.gameContainer.style.opacity = '1';
        }, { once: true });
        
        elements.muteMusicBtn.addEventListener('click', () => { gameState.isMusicMuted = !gameState.isMusicMuted; elements.musicaFundo.muted = gameState.isMusicMuted; elements.muteMusicBtn.textContent = gameState.isMusicMuted ? 'üîá' : 'üéµ'; });
        
        // CORRIGIDO: toggleAudioButton s√≥ afeta a narra√ß√£o (isAudioEnabled)
        elements.toggleAudioButton.addEventListener('click', () => { 
            gameState.isAudioEnabled = !gameState.isAudioEnabled; 
            elements.toggleAudioButton.textContent = gameState.isAudioEnabled ? 'üîä' : 'üîá'; 
            if (!gameState.isAudioEnabled) { 
                speechSynthesis.cancel(); 
            }
        });
        
        elements.subjectSelectionContainer.addEventListener('click', (event) => { if(event.target.classList.contains('subject-btn')){ playClickSound(); startGame(event.target.dataset.subject); }});
        elements.nextButton.addEventListener('click', () => { playClickSound(); if (gameState.isGameOver) resetFullGame(); else { gameState.currentQuestionIndex++; showNextQuestion(); } });
        elements.fiftyFiftyBtn.addEventListener('click', () => { playClickSound(); useFiftyFifty(); });
        elements.skipBtn.addEventListener('click', () => { playClickSound(); useSkip(); });
        elements.cardsBtn.addEventListener('click', () => { playClickSound(); useCards(); });
        elements.shopBtn.addEventListener('click', () => { playClickSound(); elements.shopModal.style.display = 'flex'; });
        elements.closeShopBtn.addEventListener('click', () => { playClickSound(); elements.shopModal.style.display = 'none'; });
        elements.shopItemsContainer.addEventListener('click', (event) => { if (event.target.classList.contains('buy-btn')) { playClickSound(); buyHelp(event.target.dataset.help); }});
        elements.rankingBtn.addEventListener('click', () => { playClickSound(); displayRanking(); elements.rankingModal.style.display = 'flex'; });
        elements.closeRankingBtn.addEventListener('click', () => { playClickSound(); elements.rankingModal.style.display = 'none'; });
        elements.stopBtn.addEventListener('click', () => { playClickSound(); endGame(false); }); 
        elements.continueBtn.addEventListener('click', () => { playClickSound(); gameState.currentQuestionIndex++; showNextQuestion(); });
    }
    
    function loadVoices() { gameState.ptBrVoice = speechSynthesis.getVoices().find(voice => voice.lang === 'pt-BR' || voice.lang.startsWith('pt-')); }
    
    // CORRIGIDO: speakText √© a √∫nica fun√ß√£o que checa isAudioEnabled
    function speakText(text) { 
        if (!gameState.isAudioEnabled || !gameState.ptBrVoice) return; 
        speechSynthesis.cancel(); 
        const utterance = new SpeechSynthesisUtterance(text); 
        utterance.voice = gameState.ptBrVoice; 
        utterance.rate = 1.1; 
        utterance.pitch = 1; 
        speechSynthesis.speak(utterance); 
    }
    
    function triggerConfetti() { confetti({ particleCount: 150, spread: 90, origin: { y: 0.6 } }); }
    
    // CORRIGIDO: Fun√ß√µes de som n√£o checam mais 'isAudioEnabled'
    function playClickSound() { if (elements.clickSound) { elements.clickSound.currentTime = 0; elements.clickSound.play().catch(console.error); } }
    function playCorrectSound() { if (elements.correctSound) { elements.correctSound.currentTime = 0; elements.correctSound.play().catch(console.error); } }
    function playWrongSound() { if (elements.wrongSound) { elements.wrongSound.currentTime = 0; elements.wrongSound.play().catch(console.error); } }

    function startTimer() {
        gameState.timeLeft = TIMER_DURATION;
        elements.timerText.textContent = gameState.timeLeft;
        elements.timerContainer.classList.remove('danger');
        if(elements.timerVisual) elements.timerVisual.style.setProperty('--progress', '100');
        gameState.timerInterval = setInterval(() => {
            gameState.timeLeft--;
            elements.timerText.textContent = gameState.timeLeft;
            const progressPercentage = (gameState.timeLeft / TIMER_DURATION) * 100;
            if(elements.timerVisual) elements.timerVisual.style.setProperty('--progress', progressPercentage);
            // CORRIGIDO: Som de tick n√£o checa mais 'isAudioEnabled'
            if (gameState.timeLeft === 5) elements.tickSound.play().catch(console.error);
            if (gameState.timeLeft <= 5) elements.timerContainer.classList.add('danger');
            if (gameState.timeLeft <= 0) handleTimeUp();
        }, 1000);
    }
    
    function stopTimer() { clearInterval(gameState.timerInterval); elements.tickSound.pause(); elements.tickSound.currentTime = 0; }
    
    function handleTimeUp() {
        stopTimer();
        speakText("Tempo esgotado!");
        Array.from(elements.answersContainer.children).forEach(b => {
            b.disabled = true;
            if (b.textContent === gameState.shuffledQuestions[gameState.currentQuestionIndex]?.correctAnswer) b.classList.add('correct');
        });
        handleIncorrectAnswer();
    }

    function getRanking() { return JSON.parse(sessionStorage.getItem('showDoMilhaoRanking')) || []; }
    
    function saveScore() {
        if (!gameState.playerName || gameState.score === 0) return;
        const ranking = getRanking();
        ranking.push({ name: gameState.playerName, score: gameState.score });
        ranking.sort((a, b) => b.score - a.score);
        sessionStorage.setItem('showDoMilhaoRanking', JSON.stringify(ranking.slice(0, 10)));
    }
    
    function displayRanking() {
        const ranking = getRanking();
        elements.rankingList.innerHTML = '';
        if (ranking.length === 0) {
            elements.rankingList.innerHTML = '<p>Nenhuma pontua√ß√£o registrada.</p>';
            return;
        }
        ranking.forEach((entry, index) => {
            const li = document.createElement('li');
            li.classList.add('ranking-item');
            li.innerHTML = `<span>${index + 1}. ${entry.name}</span><span>R$ ${entry.score.toLocaleString('pt-BR')}</span>`;
            elements.rankingList.appendChild(li);
        });
    }

    function renderPrizeLadder() {
        elements.prizeLadder.innerHTML = '';
        if (!gameState.shuffledQuestions || gameState.shuffledQuestions.length === 0) return; 
        const relevantPrizeLevels = prizeLevels.slice(1, gameState.shuffledQuestions.length + 1);
        relevantPrizeLevels.forEach((prize, index) => {
            const li = document.createElement('li');
            li.textContent = `R$ ${prize.toLocaleString('pt-BR')}`;
            li.classList.add('prize-item');
            li.dataset.level = index;
            elements.prizeLadder.appendChild(li);
        });
    }
    
    function updatePrizeLadderHighlight() {
        const prizeItems = document.querySelectorAll('.prize-item');
        let achievedLevel = -1;
        for (let i = 0; i < gameState.currentQuestionIndex; i++) {
             if (prizeLevels[i + 1] <= gameState.score) {
                 achievedLevel = i;
             }
        }
        prizeItems.forEach(item => {
            const itemLevel = parseInt(item.dataset.level);
            item.classList.remove('current-prize', 'achieved-prize');
            if (itemLevel <= achievedLevel) item.classList.add('achieved-prize');
        });
        if (!gameState.isGameOver) {
            const currentPrizeItem = elements.prizeLadder.querySelector(`.prize-item[data-level='${gameState.currentQuestionIndex}']`);
            if (currentPrizeItem) currentPrizeItem.classList.add('current-prize');
        }
    }

    function shuffle(array) { const n = [...array]; for (let i = n.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [n[i], n[j]] = [n[j], n[i]]; } return n; }
    
    function startGame(subject) {
        // L√≥gica do Desafio Misto
        if (subject === 'misto') {
            let mixedQuestions = [];
            Object.values(allQuestions).forEach(arr => mixedQuestions.push(...arr)); 
             if (mixedQuestions.length === 0) { alert("Erro: Nenhuma pergunta encontrada."); return; }
            gameState.shuffledQuestions = shuffle(mixedQuestions).slice(0, prizeLevels.length - 1); // Embaralha e limita a 15
        } else if (allQuestions && allQuestions[subject]) {
            gameState.shuffledQuestions = shuffle([...allQuestions[subject]]); 
        } else {
            console.error(`Mat√©ria "${subject}" n√£o encontrada.`); alert("Erro: Mat√©ria inv√°lida."); return;
        }

        gameState.playerName = elements.playerNameInput.value.trim();
        if (!gameState.playerName) { alert("Digite seu nome!"); elements.playerNameInput.focus(); return; }
        elements.musicaFundo.volume = 0.2;
        gameState.isGameOver = false;
        elements.startScreen.style.display = 'none';
        elements.gameScreen.style.display = 'block';
        renderPrizeLadder(); 
        gameState.currentQuestionIndex = 0;
        gameState.score = 0;
        elements.nextButton.style.display = 'none';
        updateHelpButtonsUI();
        showNextQuestion();
    }

    function showNextQuestion() {
        resetStateForNewQuestion();
        if (gameState.currentQuestionIndex >= gameState.shuffledQuestions.length) { endGame(true); return; }
        updatePrizeLadderHighlight();
        updateStatus();
        const currentQuestion = gameState.shuffledQuestions[gameState.currentQuestionIndex];
        elements.questionContainer.textContent = currentQuestion.question;
        elements.questionContainer.classList.add('fade-in'); 
        speechSynthesis.cancel();
        let textToSpeak = `Valendo ${prizeLevels[gameState.currentQuestionIndex + 1]?.toLocaleString('pt-BR') ?? 'o pr√™mio m√°ximo'} reais. ${currentQuestion.question}.`; 
        const shuffledAnswers = shuffle([...currentQuestion.answers]); 
        shuffledAnswers.forEach((answer, index) => {
            const button = document.createElement('button');
            button.textContent = answer;
            button.classList.add('answer-btn', 'slide-up-fade-in'); 
            button.style.animationDelay = `${index * 0.1}s`; 
            button.addEventListener('click', () => selectAnswer(button, answer));
            elements.answersContainer.appendChild(button);
            textToSpeak += ` Alternativa ${['A', 'B', 'C', 'D'][index]}: ${answer}.`;
        });
        speakText(textToSpeak);
        startTimer();
        
        // CORRIGIDO: L√≥gica de desativar ajuda na pergunta final
        if (gameState.currentQuestionIndex === gameState.shuffledQuestions.length - 1) { 
            elements.feedbackContainer.textContent = "Pergunta do Milh√£o! Sem ajudas!"; 
            speakText("Pergunta do Milh√£o! Sem ajudas! Boa sorte!"); 
            // Desativa os bot√µes
            elements.fiftyFiftyBtn.disabled = true;
            elements.skipBtn.disabled = true;
            elements.cardsBtn.disabled = true;
        } 
        // A fun√ß√£o updateHelpButtonsUI() chamada em resetStateForNewQuestion() j√° cuida de reativar
    }

    function selectAnswer(selectedButton, selectedAnswer) {
        stopTimer();
        speechSynthesis.cancel();
        [elements.fiftyFiftyBtn, elements.skipBtn, elements.cardsBtn].forEach(btn => btn.disabled = true);
        const correctAnswer = gameState.shuffledQuestions[gameState.currentQuestionIndex]?.correctAnswer; 
        Array.from(elements.answersContainer.children).forEach(b => { 
            b.disabled = true; 
            if (correctAnswer && b.textContent === correctAnswer) b.classList.add('correct'); 
        });
        if (correctAnswer && selectedAnswer === correctAnswer) handleCorrectAnswer();
        else { selectedButton.classList.add('incorrect'); handleIncorrectAnswer(); }
    }

    function handleCorrectAnswer() {
        playCorrectSound(); // CORRIGIDO: Toca antes
        speakText("Resposta Certa!");
        triggerConfetti();
        gameState.score = prizeLevels[gameState.currentQuestionIndex + 1] ?? gameState.score; 
        gameState.playerCoins += COINS_PER_CORRECT_ANSWER;
        // saveProgress(); // REMOVIDO
        elements.feedbackContainer.textContent = `+${COINS_PER_CORRECT_ANSWER} ü™ô`;
        elements.feedbackContainer.style.color = '#facc15';
        updateStatus();
        updatePrizeLadderHighlight();
        if (safeHavens.includes(gameState.score) && gameState.currentQuestionIndex < gameState.shuffledQuestions.length - 1) {
            elements.feedbackContainer.textContent = `Voc√™ garantiu R$ ${gameState.score.toLocaleString('pt-BR')}! Deseja parar ou continuar?`;
            elements.stopBtn.textContent = `Parar (Levar R$ ${gameState.score.toLocaleString('pt-BR')})`;
            elements.decisionButtonsContainer.style.display = 'flex';
            elements.nextButton.style.display = 'none';
        } else if (gameState.currentQuestionIndex >= gameState.shuffledQuestions.length - 1) {
            setTimeout(() => endGame(true), 1500);
        } else {
            elements.nextButton.textContent = 'Pr√≥xima Pergunta';
            elements.nextButton.style.display = 'block';
            elements.decisionButtonsContainer.style.display = 'none';
        }
    }
    
    function handleIncorrectAnswer() { 
        playWrongSound();
        const correctAnswer = gameState.shuffledQuestions[gameState.currentQuestionIndex]?.correctAnswer; 
        speakText(`Errado!`); 
        setTimeout(() => endGame(false, correctAnswer), 2500); 
    }
    
    function endGame(hasWon, correctAnswer = '') {
        gameState.isGameOver = true;
        stopTimer();
        let endMessage = 'FIM DE JOGO!';
        const lastPrizeIndex = Math.min(gameState.shuffledQuestions.length, prizeLevels.length - 1); 
        
        if (hasWon && gameState.shuffledQuestions.length > 0) { 
             const maxPrize = prizeLevels[lastPrizeIndex]; 
             gameState.score = maxPrize; 
             endMessage = `PARAB√âNS! VOC√ä GANHOU R$ ${maxPrize.toLocaleString('pt-BR')}!`;
             setTimeout(() => { confetti({ particleCount: 400, spread: 180, ticks: 100, origin: { y: 0.5 } }); }, 500);
        
        // CORRIGIDO: L√≥gica de "errar" (porto seguro)
        } else if (!hasWon) {
            // Se o jogador 'parou' (correctAnswer est√° vazio), o score atual j√° √© o seguro.
            // Se o jogador 'errou' (correctAnswer tem valor), o score j√° foi salvo na fun√ß√£o handleCorrectAnswer
            // e N√ÉO √© alterado aqui, mantendo o valor do √∫ltimo acerto.
            if (correctAnswer) { // Apenas se 'errou'
                 endMessage = "QUE PENA, VOC√ä ERROU!";
            }
        }

        updatePrizeLadderHighlight();
        document.querySelectorAll('.prize-item').forEach(item => item.classList.remove('current-prize'));
        elements.questionContainer.textContent = endMessage;
        let finalMessageHTML = `<p style="font-size: 1.5em; text-align: center;">Voc√™ terminou com R$ ${gameState.score.toLocaleString('pt-BR')}</p>`;
        if (!hasWon && correctAnswer) { finalMessageHTML += `<p style="font-size: 1.1em; text-align: center; margin-top: 15px;">A resposta correta era: <strong>${correctAnswer}</strong></p>`; }
        elements.answersContainer.innerHTML = finalMessageHTML;
        speakText(`${endMessage}. Voc√™ terminou com R$ ${gameState.score.toLocaleString('pt-BR')}.`);
        saveScore();
        elements.nextButton.textContent = 'Jogar Novamente';
        elements.nextButton.style.display = 'block';
        elements.decisionButtonsContainer.style.display = 'none';
    }

    // CORRIGIDO: Reset das moedas e invent√°rio
    function resetFullGame() {
        elements.musicaFundo.volume = 1.0;
        elements.gameScreen.style.display = 'none';
        elements.startScreen.style.display = 'block';
        gameState.playerCoins = defaultGameState.playerCoins;
        gameState.helpInventory = {...defaultGameState.helpInventory};
        updateCoinDisplay();
        updateHelpButtonsUI();
    }
    
    // CORRIGIDO: Fun√ß√£o 50:50 com feedback visual
    function useFiftyFifty() {
        if (gameState.helpInventory.fiftyFifty <= 0) return;
        gameState.helpInventory.fiftyFifty--;
        updateHelpButtonsUI();
        elements.fiftyFiftyBtn.disabled = true;
        speakText("Ok, eliminando duas alternativas...");
        const { correctAnswer, answers } = gameState.shuffledQuestions[gameState.currentQuestionIndex];
        const incorrectAnswers = shuffle(answers.filter(a => a !== correctAnswer));
        
        let removedCount = 0;
        Array.from(elements.answersContainer.children).forEach(button => {
            // Garante que n√£o vai desabilitar a resposta correta
            if (button.textContent !== correctAnswer && removedCount < 2) {
                 // Verifica se √© uma das incorretas sorteadas (ou qualquer incorreta)
                 if (incorrectAnswers.includes(button.textContent)) {
                    button.style.backgroundColor = '#0c1a54'; // Fundo escuro
                    button.style.borderColor = '#1e3a8a';    // Borda escura
                    button.style.color = '#777';            // Texto cinza
                    button.style.opacity = '0.7';           // Opacidade
                    button.disabled = true;
                    removedCount++;
                 }
            }
        });
    }

    function useSkip() {
        if (gameState.helpInventory.skip <= 0) return;
        stopTimer();
        gameState.helpInventory.skip--;
        updateHelpButtonsUI();
        speakText("Pergunta pulada!");
        gameState.currentQuestionIndex++;
        setTimeout(() => showNextQuestion(), 1000);
    }

    function useCards() {
        if (gameState.helpInventory.cards <= 0) return;
        gameState.helpInventory.cards--;
        updateHelpButtonsUI();
        elements.cardsBtn.disabled = true;
        const { correctAnswer, answers } = gameState.shuffledQuestions[gameState.currentQuestionIndex];
        let suggestion = (Math.random() < 0.7) ? correctAnswer : shuffle(answers.filter(a => a !== correctAnswer))[0];
        elements.feedbackContainer.textContent = `As cartas sugerem: "${suggestion}"`;
        speakText(`As cartas sugerem: ${suggestion}`);
    }

    function updateCoinDisplay() {
        const coinText = `ü™ô ${gameState.playerCoins}`;
        if(elements.coinBalance) elements.coinBalance.textContent = coinText;
        if(elements.shopCoinBalance) elements.shopCoinBalance.textContent = `Seu saldo: ${coinText}`;
    }

    // CORRIGIDO: L√≥gica de desativar bot√µes
    function updateHelpButtonsUI() {
        if (!gameState.helpInventory) gameState.helpInventory = {...defaultGameState.helpInventory};
        
        const fiftyFiftyCount = gameState.helpInventory.fiftyFifty || 0;
        const skipCount = gameState.helpInventory.skip || 0;
        const cardsCount = gameState.helpInventory.cards || 0;

        if(elements.fiftyFiftyBtn) elements.fiftyFiftyBtn.textContent = `üéì 50:50 (x${fiftyFiftyCount})`;
        if(elements.skipBtn) elements.skipBtn.textContent = `‚è© Pular (x${skipCount})`;
        if(elements.cardsBtn) elements.cardsBtn.textContent = `üÉè Cartas (x${cardsCount})`;
        
        // Verifica se √© a √∫ltima pergunta
        const isLastQuestion = gameState.shuffledQuestions.length > 0 && gameState.currentQuestionIndex === gameState.shuffledQuestions.length - 1;
        
        if(elements.fiftyFiftyBtn) elements.fiftyFiftyBtn.disabled = fiftyFiftyCount <= 0 || isLastQuestion;
        if(elements.skipBtn) elements.skipBtn.disabled = skipCount <= 0 || isLastQuestion;
        if(elements.cardsBtn) elements.cardsBtn.disabled = cardsCount <= 0 || isLastQuestion;
    }

    function buyHelp(helpType) {
        const price = helpPrices[helpType];
        if (gameState.playerCoins >= price) {
            gameState.playerCoins -= price;
            gameState.helpInventory[helpType]++;
            updateCoinDisplay();
            updateHelpButtonsUI();
            alert(`Comprou uma ajuda!`);
        } else {
            alert("Moedas insuficientes!");
        }
    }
    
    function resetStateForNewQuestion() {
        stopTimer(); 
        elements.timerText.textContent=TIMER_DURATION; 
        elements.timerContainer.classList.remove('danger'); 
        if(elements.timerVisual) elements.timerVisual.style.setProperty('--progress','100'); 
        elements.answersContainer.innerHTML=''; 
        elements.feedbackContainer.textContent=''; 
        elements.nextButton.style.display='none'; 
        elements.decisionButtonsContainer.style.display='none'; 
        elements.questionContainer.classList.remove('fade-in'); 
        updateHelpButtonsUI(); // Reativa os bot√µes de ajuda (se houver)
    }
    
    function updateStatus() { 
        elements.score.textContent=`Pr√™mio: R$ ${gameState.score.toLocaleString('pt-BR')}`; 
        elements.questionCounter.textContent=gameState.shuffledQuestions.length > 0 ? `Pergunta ${gameState.currentQuestionIndex + 1} / ${gameState.shuffledQuestions.length}`:'Carregando...'; 
        updateCoinDisplay(); 
    }
    
    initialSetup(); // Inicia o jogo
});
</script>

<div vw class="enabled"></div>
<script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
<script>
    try { new window.VLibras.Widget('https://vlibras.gov.br/app'); } 
    catch (error) { console.error("Erro ao inicializar VLibras:", error); }
</script>
</body>
</html>